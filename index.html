
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TempMail Clone</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#0b0f19; --card:#151a2b; --text:#e6e7ee; --muted:#aeb3c2; --accent:#6ea8fe; --border:#2a3150; }
    *{box-sizing:border-box}
    body{margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:var(--bg); color:var(--text);}
    .wrap{max-width:900px; margin:24px auto; padding:16px;}
    .card{background:var(--card); border:1px solid var(--border); border-radius:16px; padding:16px; box-shadow:0 6px 24px rgba(0,0,0,.25)}
    h1{font-size:22px; margin:0 0 12px}
    .row{display:flex; flex-wrap:wrap; gap:8px; align-items:center}
    .btn{border:1px solid var(--border); background:transparent; color:var(--text); padding:10px 14px; border-radius:12px; cursor:pointer}
    .btn:hover{border-color:#3a4270}
    .btn.primary{background:var(--accent); color:#081028; border-color:transparent}
    .email-box{display:flex; gap:8px; flex-wrap:wrap; align-items:center; background:#0e1424; border:1px dashed var(--border); padding:10px 12px; border-radius:12px}
    .email{font-weight:700; color:#a5c8ff; word-break:break-all}
    .muted{color:var(--muted); font-size:13px}
    table{width:100%; border-collapse:collapse; margin-top:12px; overflow:hidden; border-radius:12px}
    th, td{padding:12px; text-align:left; border-bottom:1px solid var(--border); font-size:14px}
    th{background:#121831; color:#c7cbe0}
    tr:hover td{background:#10162b}
    .center{text-align:center}
    .badge{font-size:12px; padding:2px 8px; border:1px solid var(--border); border-radius:999px; color:var(--muted)}
    .footer{margin-top:10px}
    dialog{border:none; border-radius:16px; padding:0; width:min(800px, 95vw); background:#0f1426; color:var(--text)}
    .modal-head{padding:14px 16px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center}
    .modal-body{padding:16px; max-height:70vh; overflow:auto}
    .close{background:transparent; border:1px solid var(--border); color:var(--text); border-radius:10px; padding:8px 12px; cursor:pointer}
    .spinner{width:18px; height:18px; border:2px solid var(--border); border-top-color:var(--accent); border-radius:50%; animation:spin 1s linear infinite; display:inline-block; vertical-align:middle}
    @keyframes spin{to{transform:rotate(360deg)}}
    @media (max-width:600px){ th:nth-child(4), td:nth-child(4){display:none} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>ðŸ•’ TempMail (1secmail API)</h1>
      <div class="row" style="margin-bottom:10px">
        <button class="btn primary" onclick="generateEmail()">Generate New Email</button>
        <button class="btn" onclick="refreshInbox()">Refresh Inbox</button>
        <span class="badge" id="autorefreshBadge">Auto-refresh: On (10s)</span>
      </div>

      <div class="email-box">
        <span class="muted">Your Temp Email:</span>
        <span id="email" class="email">---</span>
        <button class="btn" onclick="copyEmail()">Copy</button>
      </div>

      <table id="inboxTable">
        <thead>
          <tr><th>From</th><th>Subject</th><th class="center">ID</th><th>Date</th></tr>
        </thead>
        <tbody id="inboxBody">
          <tr><td colspan="4" class="center muted">Generate an email and click Refresh. <span class="spinner" style="display:none" id="spin"></span></td></tr>
        </tbody>
      </table>

      <div class="footer muted">
        Tip: Kuch websites disposable email domains ko block karti hainâ€”ye normal hai.
      </div>
    </div>
  </div>

  <dialog id="mailModal">
    <div class="modal-head">
      <div id="modalTitle">Mail</div>
      <button class="close" onclick="closeModal()">Close</button>
    </div>
    <div class="modal-body" id="modalBody">
      <div class="muted">Loadingâ€¦</div>
    </div>
  </dialog>

  <script>
    let currentEmail = "";
    let username = "";
    let domain = "";
    let autoInterval = null;

    function setLoading(state) {
      const spin = document.getElementById("spin");
      if (!spin) return;
      spin.style.display = state ? "inline-block" : "none";
    }

    async function generateEmail() {
      try {
        setLoading(true);
        const res = await fetch("https://www.1secmail.com/api/v1/?action=genRandomMailbox&count=1");
        const data = await res.json();
        currentEmail = data[0];
        document.getElementById("email").textContent = currentEmail;
        [username, domain] = currentEmail.split("@");
        startAutoRefresh();
        await refreshInbox();
      } catch (e) {
        alert("Failed to generate email. Try again.");
      } finally {
        setLoading(false);
      }
    }

    function copyEmail() {
      if (!currentEmail) return alert("Generate an email first.");
      navigator.clipboard.writeText(currentEmail).then(() => {
        alert("Copied: " + currentEmail);
      });
    }

    async function refreshInbox() {
      if (!username || !domain) return alert("Generate an email first.");
      const body = document.getElementById("inboxBody");
      body.innerHTML = `<tr><td colspan="4" class="center muted">Checkingâ€¦ <span class="spinner"></span></td></tr>`;
      try {
        const url = `https://www.1secmail.com/api/v1/?action=getMessages&login=${encodeURIComponent(username)}&domain=${encodeURIComponent(domain)}`;
        const res = await fetch(url);
        const data = await res.json();

        if (!Array.isArray(data) || data.length === 0) {
          body.innerHTML = `<tr><td colspan="4" class="center muted">No emails yet. Try again in a few seconds.</td></tr>`;
          return;
        }

        body.innerHTML = "";
        data.sort((a,b)=> new Date(b.date)-new Date(a.date));
        data.forEach(m => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${escapeHTML(m.from || "")}</td>
            <td><a href="#" onclick="openMail(${m.id});return false">${escapeHTML(m.subject || "(no subject)")}</a></td>
            <td class="center">${m.id}</td>
            <td>${m.date || ""}</td>
          `;
          body.appendChild(tr);
        });
      } catch (e) {
        body.innerHTML = `<tr><td colspan="4" class="center muted">Error loading inbox. Try again.</td></tr>`;
      }
    }

    async function openMail(id) {
      if (!username || !domain) return;
      const modal = document.getElementById("mailModal");
      const title = document.getElementById("modalTitle");
      const body = document.getElementById("modalBody");
      title.textContent = "Mail #" + id;
      body.innerHTML = `<div class="muted">Loadingâ€¦</div>`;
      modal.showModal();

      try {
        const url = `https://www.1secmail.com/api/v1/?action=readMessage&login=${encodeURIComponent(username)}&domain=${encodeURIComponent(domain)}&id=${id}`;
        const res = await fetch(url);
        const mail = await res.json();

        const meta = `
          <div style="margin-bottom:8px">
            <div><b>From:</b> ${escapeHTML(mail.from || "")}</div>
            <div><b>Subject:</b> ${escapeHTML(mail.subject || "(no subject)")}</div>
            <div class="muted">${mail.date || ""}</div>
          </div>
        `;

        // Prefer htmlBody if available; fallback to textBody
        let content = "";
        if (mail.htmlBody) {
          // sandbox the HTML in an iframe
          content = `<iframe style="width:100%; height:60vh; border:1px solid #2a3150; border-radius:12px" sandbox srcdoc="${escapeAttr(mail.htmlBody)}"></iframe>`;
        } else {
          content = `<pre style="white-space:pre-wrap; background:#0c1224; border:1px solid #2a3150; padding:12px; border-radius:12px; overflow:auto;">${escapeHTML(mail.textBody || "")}</pre>`;
        }

        body.innerHTML = meta + content;

      } catch (e) {
        body.innerHTML = `<div class="muted">Failed to load message.</div>`;
      }
    }

    function closeModal(){ document.getElementById("mailModal").close(); }

    function startAutoRefresh() {
      const badge = document.getElementById("autorefreshBadge");
      if (autoInterval) clearInterval(autoInterval);
      autoInterval = setInterval(refreshInbox, 10000); // 10 seconds
      badge.textContent = "Auto-refresh: On (10s)";
    }

    // Helpers to avoid HTML injection
    function escapeHTML(str){
      return String(str)
        .replace(/&/g,"&amp;")
        .replace(/</g,"&lt;")
        .replace(/>/g,"&gt;")
        .replace(/"/g,"&quot;")
        .replace(/'/g,"&#039;");
    }
    function escapeAttr(str){
      // Escape only for putting inside iframe srcdoc attribute
      return String(str)
        .replace(/&/g,"&amp;")
        .replace(/"/g,"&quot;");
    }

    // Optional: auto-generate on first load
    // generateEmail();
  </script>
</body>
</html>
